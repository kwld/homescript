# TODO Tracker

This file is the mandatory execution tracker for all agent work in this repository.

## Tracker Instructions
1. Start every task by adding it to `Planned` or `In Progress`.
2. Move a task to `In Progress` when implementation begins.
3. Keep notes short and factual while working.
4. Mark task `Done` only after implementation is complete.
5. For every completed task include:
   - Completion date (`YYYY-MM-DD`)
   - Files changed
   - One-line outcome summary

## Planned
- [ ]Add in /scripts/id an prompt generator fully featured and modern prompt.
    It MUST:
    - Create `copy-ready` prompt for user.
    - option to select entities from ha itself and include their values to set/get so ai knows what has access to.
    - VERY detailed instructions for maximum context usage.
    - DETAILED instructions of getting and setting 
    - Have full description of HomeScript code and its name.
    - Extra input to append users message.
    - Have multiple modes: CREATE, UPDATE, OPTIMIZE, API
      - CREATE: Doesn't include current code.
      - UPDATE: Includes current code in the prompt and message about it.
      - OPTIMIZE: similar to above but with generated message to optimize.
      - API: Completly different message about this specific command API endpoint.

## In Progress
- [ ] (empty)

## Done
- [x] Add service-header auth schemes to Swagger and refresh docs revision on script save/update/delete.
  - Date: 2026-02-28
  - Files: `src/server/openapi-revision.ts`, `src/server/openapi.ts`, `src/server/routes/endpoints/scripts.ts`, `src/server/routes/endpoints/docs.ts`, `TODO.md`
  - Outcome: Swagger now exposes Bearer + `x-service-id`/`x-service-secret` + `x-service-key` auth options, and script Swagger JSON updates immediately after script create/update/delete via revision bump with no-cache headers.
- [x] Add dual HomeScript execution endpoints per script (`GET` + `POST`) and reflect in script Swagger docs.
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/run.ts`, `src/server/openapi.ts`, `TODO.md`
  - Outcome: Added `GET /api/run/:endpoint` (variables from query params) and `POST /api/run/:endpoint` (variables from JSON body), while keeping REQUIRED/OPTIONAL query injection logic and updating script-generated Swagger to show both methods.
- [x] Switch Swagger to script-definition docs in menu and move server docs to separate backend-only endpoint.
  - Date: 2026-02-28
  - Files: `src/server/openapi.ts`, `src/server/routes/endpoints/docs.ts`, `src/pages/SwaggerDocs.tsx`, `src/App.tsx`, `TODO.md`
  - Outcome: HomeScripts API Swagger now generated strictly from current scripts (including REQUIRED/OPTIONAL query params parsed from script code), rendered in-app iframe with server-side auth injection; server-wide Swagger moved to separate `/api/docs/server` endpoint not linked in menu.
- [x] Render Swagger UI in-app iframe with server-side auth token injection.
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/docs.ts`, `src/pages/SwaggerDocs.tsx`, `src/App.tsx`, `TODO.md`
  - Outcome: Added authenticated docs frame endpoint that injects bearer token into Swagger requests server-side and new `/swagger` app page rendering Swagger UI in iframe.
- [x] Add Swagger UI API docs + HomeScript keyword/runtime/lint upgrades (`REQUIRED/OPTIONAL/GOTO/LABEL`).
  - Date: 2026-02-28
  - Files: `src/server/openapi.ts`, `src/server/routes/endpoints/docs.ts`, `src/server/routes.ts`, `src/server/routes/endpoints/run.ts`, `src/App.tsx`, `src/shared/homescript.ts`, `src/shared/homescript/validation.ts`, `src/shared/homescript/if-condition.ts`, `src/shared/homescript.test.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added authenticated real Swagger UI with dynamically generated OpenAPI docs (including script endpoints), implemented REQUIRED/OPTIONAL query injection with 422 fail-fast behavior, added LABEL/GOTO execution, introduced live Monaco syntax diagnostics/underlines, and added dedicated editor coloring/autocomplete for new keywords and labels.
- [x] Expand HomeScript automated tests to cover core language/runtime features comprehensively.
  - Date: 2026-02-28
  - Files: `src/shared/homescript.test.ts`, `TODO.md`
  - Outcome: Added broad engine tests for PRINT/SET/GET/CALL, IF/ELSE IF/multiline logic, WHILE/BREAK/CONTINUE/infinite-loop guard, FUNCTION/RETURN/arg validation, IMPORT behavior, debugger breakpoints, enums, and syntax/block error paths.
- [x] Add auto-generated debug inputs, Monaco JSON parameter editors, and mock device-state runtime for script runs.
  - Date: 2026-02-28
  - Files: `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added script analysis to auto-build parameters and entity mock states, switched Test Parameters to Monaco JSON editor, added Mock Device States JSON section, and made local/debug/server run paths auto-fallback to generated inputs when manual JSON is invalid.
- [x] Add built-in HomeScript enums and fix PRINT interpolation/highlighting for variables in strings.
  - Date: 2026-02-28
  - Files: `src/shared/homescript/enums.ts`, `src/shared/homescript.ts`, `src/shared/homescript.test.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added `$ENUMS` built-ins (from separate enums file), enabled `PRINT "text $var"` interpolation, and updated Monaco tokenization so variables (including dotted paths) are highlighted inside strings.
- [x] Merge media timeline display/control into a single live-updating scrubber.
  - Date: 2026-02-28
  - Files: `src/components/MediaPlayerController.tsx`, `TODO.md`
  - Outcome: Replaced split progress+seek UI with one integrated timeline slider that shows progress and sends live throttled seek updates while dragging, with final seek on release.
- [x] Add timeline time control for media playback position.
  - Date: 2026-02-28
  - Files: `src/components/MediaPlayerController.tsx`, `TODO.md`
  - Outcome: Added draggable now-playing timeline scrubber with seek-on-release and explicit seek action, synced with current playback position and duration.
- [x] Make entity details fully responsive and add mobile left-slide drawer with close control.
  - Date: 2026-02-28
  - Files: `src/pages/Entities.tsx`, `src/components/MediaPlayerController.tsx`, `TODO.md`
  - Outcome: Fixed small-screen control overlap with grid-based button layout and added a mobile entity-details drawer that slides in from the left with backdrop and explicit close button.
- [x] Add media now-playing metadata panel with cover image and live progress.
  - Date: 2026-02-28
  - Files: `src/components/MediaPlayerController.tsx`, `TODO.md`
  - Outcome: Added currently playing card (title/artist/album/app), artwork rendering with HA URL/local proxy fallback, and real-time playback progress based on `media_position` + `media_position_updated_at`.
- [x] Unify media controller button sizes and fix Queue Mode action layout overflow.
  - Date: 2026-02-28
  - Files: `src/components/MediaPlayerController.tsx`, `TODO.md`
  - Outcome: Normalized button dimensions across media controls and switched Queue Mode apply actions to a responsive grid so Shuffle/Repeat buttons fit the container.
- [x] Fix media controller volume slider resetting while dragging.
  - Date: 2026-02-28
  - Files: `src/components/MediaPlayerController.tsx`, `TODO.md`
  - Outcome: Removed unstable effect dependencies so local media control state syncs only on real entity updates (`last_updated`) instead of every render.
- [x] Implement dedicated media controller module for `media_player` speaker entities.
  - Date: 2026-02-28
  - Files: `src/components/MediaPlayerController.tsx`, `src/components/EntityDetailsPanel.tsx`, `TODO.md`
  - Outcome: Added full in-panel media controls for transport, volume/mute, seek, source/sound mode, repeat/shuffle, play/search/browse media, and grouping, wired to Home Assistant service availability.
- [x] Make `Entities & Devices` cards clickable and add detailed inline entity control/info panel.
  - Date: 2026-02-28
  - Files: `src/pages/Entities.tsx`, `src/components/EntityDetailsPanel.tsx`, `TODO.md`
  - Outcome: Added click-to-select entity cards, persistent details panel with state/attributes metadata, quick power + light controls, and dynamic service form generated from Home Assistant service metadata.
- [x] Remediate security audit findings in auth, credentials, webhook, and transport throttling paths.
  - Date: 2026-02-28
  - Files: `server.ts`, `src/server/routes.ts`, `src/server/db.ts`, `src/server/ws-service.ts`, `src/server/routes/rate-limit.ts`, `src/server/routes/endpoints/auth.ts`, `src/server/routes/endpoints/run.ts`, `src/server/routes/endpoints/service-accounts.ts`, `src/server/routes/endpoints/webhook.ts`, `src/server/routes/middleware.test.ts`, `TODO.md`
  - Outcome: Enforced dev-only opt-in mocks, added startup guard for production mock mode, restricted OAuth popup messaging to trusted origin, hashed service secrets with legacy auto-migration, added HTTP/WS rate limits, and secured webhook execution with signed timestamped HMAC requests.
- [x] Create strict `AGENTS.md` rules and set up mandatory `TODO.md` workflow.
  - Date: 2026-02-28
  - Files: `AGENTS.md`, `TODO.md`
  - Outcome: Enforced no popup/no modal policy, minimal component guidance, reuse-first rule, latest-library policy, and mandatory tracking protocol.
- [x] Analyze app architecture and build implementation context.
  - Date: 2026-02-28
  - Files: `package.json`, `server.ts`, `src/App.tsx`, `src/server/routes.ts`, `src/server/db.ts`, `src/pages/*`, `src/components/*`, `src/shared/*`, `.env.example`
  - Outcome: Mapped architecture, runtime flows, UX constraints, and key implementation risks with baseline test/type-check status.
- [x] Improve `Execution Output` console with full debug telemetry, state reporting, execution log, backend/frontend diagnostics, Home Assistant state visibility, and success/failure highlighting.
  - Date: 2026-02-28
  - Files: `src/shared/execution-report.ts`, `src/shared/homescript.ts`, `src/server/routes.ts`, `src/components/ExecutionConsole.tsx`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added structured execution reports, engine trace events, HA activity reporting, and a tabbed console with status highlighting and debug controls.
- [x] Add a raw output console tab with clean print messages, place it next to logs, and default-select it.
  - Date: 2026-02-28
  - Files: `src/components/ExecutionConsole.tsx`, `TODO.md`
  - Outcome: Added `Raw` tab for print-only output, placed next to logs, and set as default active tab.
- [x] Improve Home Assistant connection error handling for timeout/fetch failures with clean logs and structured API errors.
  - Date: 2026-02-28
  - Files: `src/server/routes.ts`, `TODO.md`
  - Outcome: Added HA fetch timeout wrapper and normalized error reporting for states/services/service calls to avoid raw stack spam and provide clear connectivity failure messages.
- [x] Add sidebar menu entry for an LLM-friendly bot script guide with a dedicated page.
  - Date: 2026-02-28
  - Files: `src/App.tsx`, `src/pages/LLMHomeScriptGuide.tsx`, `TODO.md`
  - Outcome: Added new sidebar menu item and route for an LLM-friendly HomeScript guide page with prompt pattern, rules, and example script.
- [x] Move content scrollbar to the right edge of the main area instead of centered inner containers.
  - Date: 2026-02-28
  - Files: `src/App.tsx`, `src/pages/Guides.tsx`, `src/pages/LLMHomeScriptGuide.tsx`, `TODO.md`
  - Outcome: Main layout now owns vertical scrolling, and centered guide pages no longer render local scrollbars in the middle.
- [x] Add visible `x-service-id` and `x-service-secret` credentials flow in Service Accounts and backend auth support.
  - Date: 2026-02-28
  - Files: `src/server/db.ts`, `src/server/routes.ts`, `src/pages/ServiceAccounts.tsx`, `src/pages/Dashboard.tsx`, `TODO.md`
  - Outcome: Added dual-header service auth (`x-service-id` + `x-service-secret`) support, returned those fields from account creation, and updated UI to display/copy credentials and show Service ID in account list.
- [x] Expand LLM HomeScript guide with proper authentication usage and Markdown-style Monaco text block examples.
  - Date: 2026-02-28
  - Files: `src/pages/LLMHomeScriptGuide.tsx`, `TODO.md`
  - Outcome: Added dedicated auth section with required headers and a read-only Monaco Markdown block showing endpoint, curl example, and LLM prompt rules.
- [x] Add detailed HomeScript usage guidelines in the LLM guide page as a practical reference.
  - Date: 2026-02-28
  - Files: `src/pages/LLMHomeScriptGuide.tsx`, `TODO.md`
  - Outcome: Added a comprehensive HomeScript usage reference (syntax, commands, control flow, functions/imports, API model, debugging, and LLM generation rules) rendered in a read-only Monaco markdown block.
- [x] Create a full standalone `.md` LLM guide file for HomeScript usage.
  - Date: 2026-02-28
  - Files: `LLM_HOMESCRIPT_GUIDE.md`, `TODO.md`
  - Outcome: Added one complete ready-to-use markdown guide covering authentication, syntax, commands, API usage, debugging, LLM prompt template, and request examples.
- [x] Analyze Home Assistant instance from `.env`, verify latest official API references on the web, and create `HA_CONTEXT.md`.
  - Date: 2026-02-28
  - Files: `HA_CONTEXT.md`, `TODO.md`
  - Outcome: Probed live HA instance (version/connectivity/services/states), cross-checked official API/changelog sources, and documented current coverage plus gaps for full HA API support.
- [x] Create a proper project `.gitignore`, add it, and commit.
  - Date: 2026-02-28
  - Files: `.gitignore`, `TODO.md`
  - Outcome: Added complete ignore rules for dependencies, build/test artifacts, logs, env secrets, local databases, and editor/OS files.
- [x] Fully implement app-side WebSocket service-to-service execution and document protocol for LLMs and README.
  - Date: 2026-02-28
  - Files: `server.ts`, `README.md`, `LLM_HOMESCRIPT_GUIDE.md`, `TODO.md`
  - Outcome: Added authenticated `/api/ws/service` execution channel with streamed run/HA events and documented full protocol and examples for human and LLM usage.
- [x] Refactor oversized server bootstrap into proper server modules (routing/components style) and keep behavior unchanged.
  - Date: 2026-02-28
  - Files: `server.ts`, `src/server/ws-service.ts`, `src/server/ha-client.ts`, `src/server/routes.ts`, `TODO.md`
  - Outcome: Reduced `server.ts` to clean bootstrap, extracted WS service implementation and shared HA client utility into dedicated server modules.
- [x] Split monolithic routes into dedicated endpoint modules under route folders.
  - Date: 2026-02-28
  - Files: `src/server/routes.ts`, `src/server/routes/types.ts`, `src/server/routes/middleware.ts`, `src/server/routes/endpoints/*`, `TODO.md`
  - Outcome: Broke route handling into focused endpoint modules (auth/config/ha/service-accounts/scripts/run/webhook) with shared context and auth middleware.
- [x] Add production-ready precompiled build and Docker setup (no dev deps at runtime, no on-the-fly TS compile).
  - Date: 2026-02-28
  - Files: `tsconfig.server.json`, `package.json`, `Dockerfile`, `.dockerignore`, `.gitignore`, `README.md`, `server.ts`, `src/server/routes.ts`, `src/server/routes/*`, `src/server/ws-service.ts`, `src/server/ha-client.ts`, `TODO.md`
  - Outcome: Added full ahead-of-time production build for frontend/server, Linux multi-stage Docker runtime with production deps only, and modularized server routing/runtime components.
- [x] Rewrite `README.md` completely with up-to-date project documentation.
  - Date: 2026-02-28
  - Files: `README.md`, `TODO.md`
  - Outcome: Replaced README with a complete project guide covering architecture, auth, API usage, WebSocket protocol, production build, Docker, and quality commands.
- [x] Create a security audit document and add automated security tests.
  - Date: 2026-02-28
  - Files: `SECURITY_AUDIT.md`, `src/server/routes/middleware.test.ts`, `TODO.md`
  - Outcome: Added formal security audit with prioritized findings and introduced security-focused middleware tests validating JWT/service credential authorization paths.
- [x] Implement HA state-change trigger watcher with Script Editor trigger configuration and graph-based threshold levels.
  - Date: 2026-02-28
  - Files: `src/shared/trigger-config.ts`, `src/server/db.ts`, `src/server/ha-event-engine.ts`, `server.ts`, `src/server/routes/endpoints/scripts.ts`, `src/components/EventTriggerConfigurator.tsx`, `src/pages/ScriptEditor.tsx`, `package.json`, `package-lock.json`, `TODO.md`
  - Outcome: Added configurable per-script event triggers (toggle/any-change/sensor levels), draggable graph threshold UI, persisted trigger config, and HA websocket watcher that injects `$event.name` and `$event.value` during auto-execution.
- [x] Populate trigger graph with real Home Assistant historical data.
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/ha.ts`, `src/pages/ScriptEditor.tsx`, `src/components/EventTriggerConfigurator.tsx`, `TODO.md`
  - Outcome: Added authenticated HA history API proxy and wired Script Editor sensor trigger graph to render real recent history with inline loading/error status.
- [x] Fix history graph JSON parsing error when API returns HTML fallback.
  - Date: 2026-02-28
  - Files: `server.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added `/api/*` JSON 404 fallback and robust history response parsing to prevent `Unexpected token '<'` and surface actionable inline errors.
- [x] Add tests for history response parsing failures and validate HA history payload shape from runtime call.
  - Date: 2026-02-28
  - Files: `src/shared/history.ts`, `src/shared/history.test.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added parser unit tests (valid JSON, HTML fallback, invalid format) and confirmed live HA `/api/history/period` returns JSON series shape compatible with graph mapping.
- [x] Harden history parser for empty/nonstandard successful responses and raw HA array payloads.
  - Date: 2026-02-28
  - Files: `src/shared/history.ts`, `src/shared/history.test.ts`, `TODO.md`
  - Outcome: Added tolerant parsing for empty 2xx bodies and raw HA history shape so graph loads instead of failing with invalid response errors.
- [x] Fix trigger graph readability and align draggable level behavior with real historical value scale.
  - Date: 2026-02-28
  - Files: `src/components/EventTriggerConfigurator.tsx`, `TODO.md`
  - Outcome: Applied high-contrast tooltip styling, chart-domain auto-fit to historical values, and drag-edge behavior that expands range up/down with below-chart drop-to-remove threshold.
- [x] Smooth drag edge-expansion and normalize min/max range on drop.
  - Date: 2026-02-28
  - Files: `src/components/EventTriggerConfigurator.tsx`, `TODO.md`
  - Outcome: Replaced jumpy edge growth with throttled small expansion steps during drag and auto-adjusted range to true data+level bounds when drag ends.
- [x] Add logarithmic preview option and fix cursor/handle misalignment during edge-extension drag.
  - Date: 2026-02-28
  - Files: `src/components/EventTriggerConfigurator.tsx`, `src/shared/trigger-config.ts`, `src/server/ha-event-engine.ts`, `TODO.md`
  - Outcome: Added selectable linear/log preview scale (with safe fallback), and updated edge-extension drag logic to map handle value from cursor position after each range update to keep drag alignment stable.
- [x] Replace single trigger toggle with multi-rule builder and AND/OR logic.
  - Date: 2026-02-28
  - Files: `src/shared/trigger-config.ts`, `src/components/EventTriggerConfigurator.tsx`, `src/pages/ScriptEditor.tsx`, `src/server/ha-event-engine.ts`, `TODO.md`
  - Outcome: Implemented rule list builder (add/remove/enable/edit), group logic selector (AND/OR), per-rule event settings and graph levels, plus backend evaluation of enabled rules with legacy trigger-config migration support.
- [x] Remove per-rule toggles and add Monaco rule-expression engine using rule-name variables.
  - Date: 2026-02-28
  - Files: `src/shared/trigger-config.ts`, `src/components/EventTriggerConfigurator.tsx`, `src/server/ha-event-engine.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Rules now work by existence in list, added expression editor for `$RULE_NAME` with AND/OR/NOT logic, and backend now validates each rule per state-change then evaluates custom expression (or fallback group logic).
- [x] Add rule debugger with fake event data, syntax-highlighted rule input, and expand Script Editor Monaco workspace height.
  - Date: 2026-02-28
  - Files: `src/components/EventTriggerConfigurator.tsx`, `src/pages/ScriptEditor.tsx`, `src/shared/trigger-config.ts`, `TODO.md`
  - Outcome: Added local rule debugger (fake entity/old/new state evaluation), switched rule-expression Monaco to HomeScript highlighting, introduced debug data modes (manual/preset/randomized), and constrained top config panel so the main HomeScript editor keeps ~80vh workspace.
- [x] Style global scrollbars and move rule builder into a dropdown below script editor.
  - Date: 2026-02-28
  - Files: `src/index.css`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added app-wide custom scrollbar theming and refactored Script Editor layout to remove top split panel, placing trigger/rule configuration in a collapsible dropdown below Monaco.
- [x] Add toggle transition `From`/`To` rule matching and hide sensor-only controls for non-sensor rules.
  - Date: 2026-02-28
  - Files: `src/shared/trigger-config.ts`, `src/components/EventTriggerConfigurator.tsx`, `src/server/ha-event-engine.ts`, `TODO.md`
  - Outcome: Added per-toggle transition filters (`any/on/off` -> `any/on/off`) in UI and backend evaluator, and removed irrelevant Preview Scale/Range controls from toggle and any-change rule types.
- [x] Implement popup entity selector with filters, current state preview, and mini history graph.
  - Date: 2026-02-28
  - Files: `src/components/EntitySelectorPopup.tsx`, `src/components/EventTriggerConfigurator.tsx`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added reusable entity picker popup with search/domain/historic filters, selected entity state details, and historical sparkline preview when available; integrated into rule `Entity` field.
- [x] Add multiline HomeScript IF condition parsing and reuse shared parser for event IF wrapper evaluation.
  - Date: 2026-02-28
  - Files: `src/shared/homescript.ts`, `src/shared/homescript/expression.ts`, `src/shared/homescript/if-condition.ts`, `src/server/ha-event-engine.ts`, `src/components/EventTriggerConfigurator.tsx`, `src/shared/homescript.test.ts`, `TODO.md`
  - Outcome: Split parser logic into reusable shared modules, enabled multiline IF condition continuation in HomeScript engine, and switched event expression validation/evaluation to the same parser path used by HomeScript execution.
- [x] Add HomeScript array membership improvements (`IN`) and regex `TEST` keyword with editor highlighting.
  - Date: 2026-02-28
  - Files: `src/shared/homescript.ts`, `src/shared/homescript/expression.ts`, `src/shared/homescript/if-condition.ts`, `src/shared/homescript/validation.ts`, `src/shared/homescript.test.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added robust `IN` membership checks for arrays/strings/objects (including nested `$path.to.value` references), introduced `TEST` statement with flexible operand order and optional `INTO $var` assignment, and updated Monaco keyword/regex styling so `/regex/flags` literals render in red.
- [x] Expand test coverage for new HomeScript `IN` and `TEST` features.
  - Date: 2026-02-28
  - Files: `src/shared/homescript.test.ts`, `src/shared/homescript.validation.test.ts`, `TODO.md`
  - Outcome: Added runtime tests for `IN` (arrays, nested paths, object keys) and `TEST` (both operand orders, default result var, escaped/class regex, invalid syntax/regex), plus editor-lint diagnostics tests for `TEST` validation.
- [x] Improve debug mode UX with dedicated panel and line-by-line playback controls.
  - Date: 2026-02-28
  - Files: `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Changed Debug action to open a dedicated menu, added auto/manual debug run modes with configurable line delay and executed-line highlighting, plus selectable missing-parameter simulation for REQUIRED/OPTIONAL testing.
- [x] Add secure debug bypass mode for `/api/run/*` with admin whitelist controls and red-alert UI state.
  - Date: 2026-02-28
  - Files: `src/server/db.ts`, `src/server/ip-whitelist.ts`, `src/server/routes/run-debug-access.ts`, `src/server/routes/endpoints/debug-access.ts`, `src/server/routes/endpoints/run.ts`, `src/server/routes/middleware.ts`, `src/server/routes.ts`, `src/shared/execution-report.ts`, `src/pages/ServiceAccounts.tsx`, `src/pages/ScriptEditor.tsx`, `src/App.tsx`, `src/server/ip-whitelist.test.ts`, `src/server/routes/run-debug-access.test.ts`, `TODO.md`
  - Outcome: Added admin-managed debug bypass config (enabled flag + IP/CIDR whitelist), run-endpoint auth bypass path requiring `x-debug-bypass` + registered `x-service-id` + whitelisted client IP, global red warning mode in UI when enabled, and debug-mode toggle in Script Editor for Monaco breakpoints and debug controls.
- [x] Add live debug draft syncing/execution with separate persisted `debug_code`.
  - Date: 2026-02-28
  - Files: `src/server/db.ts`, `src/server/routes/endpoints/scripts.ts`, `src/pages/ScriptEditor.tsx`, `TODO.md`
  - Outcome: Added `scripts.debug_code` storage and debug draft update endpoint, enabled Debug-mode auto-sync of editor code to `debug_code` and automatic local execution without Save, while keeping Save action bound to non-debug main script code.
- [x] Remove `x-debug-bypass` header dependency for LAN/mobile debug bypass flow.
  - Date: 2026-02-28
  - Files: `src/server/routes/run-debug-access.ts`, `src/server/routes/run-debug-access.test.ts`, `src/pages/ServiceAccounts.tsx`, `src/App.tsx`, `TODO.md`
  - Outcome: Debug bypass now auto-applies when enabled and request has valid `x-service-id` from whitelisted IP/CIDR, without requiring extra bypass header; updated UI/security messaging and middleware tests accordingly.
- [x] Add login-page Debug tab for quick endpoint testing when debug mode is enabled.
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/debug-access.ts`, `src/App.tsx`, `TODO.md`
  - Outcome: Added public whitelist-guarded endpoint discovery for debug mode and a new login Debug tab that lists run endpoints, prebuilds JSON inputs from `REQUIRED/OPTIONAL` declarations, accepts `x-service-id`, and executes selected endpoints directly.
- [x] Make login Debug tab service-id optional and improve mobile-first endpoint testing UX.
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/debug-access.ts`, `src/App.tsx`, `TODO.md`
  - Outcome: Added dedicated public debug runner endpoint with mocked service/HA behaviors (no service ID required), added endpoint filtering and card selection, generated form inputs for REQUIRED/OPTIONAL fields, optional mock-state editor, and improved small-screen debug layout.
- [x] Align remote debug execution with Start Debug Run semantics (breakpoints + line replay).
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/debug-access.ts`, `src/App.tsx`, `TODO.md`
  - Outcome: Public debug run now executes in debug mode with configurable breakpoints and per-line delay, returns execution trace, and login Debug tab replays highlighted lines with breakpoint markers to mirror Start Debug Run behavior from remote devices.
- [x] Move remote execution replay from login Debug tab to Script Editor debug view.
  - Date: 2026-02-28
  - Files: `src/server/routes/endpoints/debug-access.ts`, `src/pages/ScriptEditor.tsx`, `src/App.tsx`, `TODO.md`
  - Outcome: Added live debug session feed endpoint for authenticated UI and Script Editor polling/replay (line highlighting + breakpoint markers) when debug mode is enabled, while login Debug tab remains a remote run launcher without replay playback.
